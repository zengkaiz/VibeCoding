# 新旧数据结构对比分析

## 数据来源对比

### 旧数据：造物矩阵｜超级个体开放麦
- 节目数：9期
- 订阅数：90
- 主播：Cell细胞、琳月_Lynn

### 新数据：只有猫知道CatsKnow
- 节目数：68期
- 订阅数：18,990
- 主播：CatsKnow-R、Catsknow莉莉丘

---

## 字段差异对比

### 1. 播客信息（Podcast Level）

| 字段 | 旧数据 | 新数据 | 状态 |
|------|--------|--------|------|
| `title` | ✅ | ✅ | 相同 |
| `author` | ✅ | ✅ | 相同 |
| **`brief`** | ❌ | ✅ | **新增** |
| `description` | ✅ | ✅ | 相同 |
| `subscriptionCount` | ✅ | ✅ | 相同 |
| `episodeCount` | ✅ | ✅ | 相同 |
| `image` | ✅ | ✅ | 相同 |
| `color` | ✅ | ✅ | 相同 |
| `podcasters` | ✅ | ✅ | 相同 |
| `contacts` | ✅ | ✅ | 相同 |

**重要变化**：
- ✅ 新增 `brief` 字段：简短的播客口号
  - 旧数据：无
  - 新数据：`"看见罪案背后的人性灵光"`

**⚠️ Episode 图片路径变化**：
- 旧数据：`episode.image.picUrl`（每个episode有独立image）
- 新数据：`episode.podcast.image.picUrl`（episode没有独立image，需要从内嵌的podcast对象获取）

---

### 2. 节目描述格式（Episode Description）

#### 旧数据格式（造物矩阵）
使用 Emoji 标记的结构化描述：

```
🧩 一句话简介
从大厂程序员到...

📖 详细介绍
本期由...

🏷️关键词标签
#X增长 #个人品牌 #去杠杆

⏩ 时间轴章节索引
00:00｜开场 & 本期主题预告
00:26｜主持人抛题
01:36｜琳月自我介绍
```

#### 新数据格式（只有猫知道）
更简洁的格式，无 Emoji 标记：

```
序/
北魏兰陵长公主痛苦地躺在地上...

轴/
00:00 介绍《公主之死》
04:20 那起悲剧的经过
14:15 那起悲剧的辩论：杀子罪

图片/

音乐/
《她不再幻想》陈婧霏

参考/
《公主之死》by 李贞德

感谢赞赏/
你们的认可，支持我们继续讲下去：
HD151659z、毕加索狗勾...
```

---

### 3. 时间轴格式差异

| 格式 | 旧数据示例 | 新数据示例 |
|------|-----------|-----------|
| 格式1 | `00:00｜开场` | ❌ 不使用 |
| 格式2 | `00:26 \| 主持人抛题` | ❌ 不使用 |
| **格式3** | ❌ 不使用 | `00:00 介绍《公主之死》` |

**关键差异**：
- 旧格式：使用 `｜` 或 `|` 分隔时间和标题
- **新格式：直接使用空格分隔时间和标题**

---

### 4. 标签提取差异

#### 旧数据
有专门的标签区域：
```
🏷️关键词标签
#X增长 #个人品牌 #去杠杆 #副业
```

#### 新数据
**无标签区域**，描述中也没有 `#标签` 格式

---

### 5. 一句话简介提取差异

#### 旧数据
有明确的标记：
```
🧩 一句话简介
从大厂程序员到...
```

#### 新数据
**无明确标记**，需要从描述开头提取

---

## 需要调整的代码

### 1. 播客信息显示
**文件**：`frontend/src/pages/Home.jsx`

```jsx
// 当前代码
<p className="hero-description">{podcast.description}</p>

// 需要改为（优先显示 brief）
<p className="hero-description">
  {podcast.brief || podcast.description}
</p>
```

---

### 2. 章节解析
**文件**：`frontend/src/utils/parseChapters.js`

当前正则：
```javascript
const match = line.match(/(\d{1,2}:\d{2}(?::\d{2})?)\s*[｜|]\s*(.+)/);
```

需要改为支持多种格式：
```javascript
// 支持3种格式：
// 1. 00:00｜标题
// 2. 00:00 | 标题
// 3. 00:00 标题（新格式）

const match = line.match(
  /(\d{1,2}:\d{2}(?::\d{2})?)\s*(?:[｜|]|\s{2,})\s*(.+)/
);
```

---

### 3. 标签提取
**文件**：`frontend/src/utils/extractTags.js`

当前逻辑依赖 emoji 标记和 `#标签` 格式。

新数据可能无标签，需要：
- 如果没有标签，返回空数组
- 不报错，优雅降级

---

### 4. 简介提取
**文件**：`frontend/src/utils/extractTags.js`

当前依赖 `🧩` 标记，需要改为：
```javascript
export function extractSummary(description) {
  if (!description) return '';

  // 方法1：查找 🧩 标记
  const emojiMatch = description.match(/🧩\s*一句话简介\s*\n(.*?)(?:\n|$)/);
  if (emojiMatch) {
    return emojiMatch[1].trim();
  }

  // 方法2：查找 "序/" 后的内容
  const prefaceMatch = description.match(/序\/\s*\n(.*?)(?:\n\n|$)/s);
  if (prefaceMatch) {
    return prefaceMatch[1].trim().substring(0, 200); // 取前200字
  }

  // 方法3：取第一段非空文本（前100字）
  const lines = description.split('\n');
  for (const line of lines) {
    const trimmed = line.trim();
    if (trimmed && trimmed.length > 20) {
      return trimmed.substring(0, 100);
    }
  }

  return '';
}
```

---

## 修复优先级

### 高优先级 🔴
1. ✅ **章节解析** - 支持新格式（空格分隔）
2. ✅ **播客简介显示** - 优先显示 `brief`
3. ✅ **图片路径修复** - 从 `episode.podcast.image` 获取图片

### 中优先级 🟡
4. ✅ **简介提取** - 支持多种格式
5. ✅ **标签提取** - 优雅降级（无标签时返回空）

### 低优先级 🟢
5. 样式微调（如果需要）

---

## 兼容性策略

所有修改都应保持**向后兼容**，即：
- ✅ 旧数据（造物矩阵）仍能正常显示
- ✅ 新数据（只有猫知道）也能正常显示
- ✅ 未来其他格式的数据也能降级处理

---

## 测试清单

修改完成后需要测试：

### 新数据测试
- [x] 播客标题和简介正确显示
- [x] 主播信息正确显示
- [x] 节目列表正确显示
- [x] **节目封面图片正确显示**
- [x] 时间轴章节正确解析（空格分隔格式）
- [ ] 章节点击跳转正常
- [x] 无标签时不报错
- [x] 简介提取正确（从 "序/" 提取）

### 向后兼容测试（用旧数据）
- [ ] 旧数据仍能正常显示
- [ ] emoji 格式标签仍能提取
- [ ] `｜|` 格式章节仍能解析

---

## 总结

主要变化：
1. 新增 `brief` 字段
2. 时间轴从 `｜` 分隔改为空格分隔
3. 无 emoji 标记的描述格式
4. 无 `#标签` 格式

解决方案：
1. 优先读取 `brief`
2. 正则匹配支持多种分隔符
3. 优雅降级处理无标签情况
4. 多策略提取简介
